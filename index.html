<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPB Cobranza - Gestión Inteligente de Cobros</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Pantalla de autenticación -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <div class="auth-header">
                <i class="fas fa-file-invoice-dollar"></i>
                <h1>PPB Cobranza</h1>
                <p>Sistema de Gestión Profesional</p>
            </div>
            
            <div class="auth-card" id="authCard">
                <h2><i class="fas fa-lock"></i> Acceso Seguro</h2>
                <div id="authMessage" class="alert" style="display: none;"></div>
                
                <form id="authForm">
                    <div class="form-group">
                        <label for="accessKey">Clave de Acceso</label>
                        <div class="input-with-icon">
                            <i class="fas fa-key"></i>
                            <input type="password" id="accessKey" class="form-control" 
                                   placeholder="Ingrese clave de 4 dígitos" 
                                   maxlength="4"
                                   pattern="[A-Za-z0-9]{4}"
                                   title="Clave de 4 dígitos (letras y números)" 
                                   required>
                        </div>
                        <small class="form-hint">Formato: Letra, Número, Letra, Número (ej: A1B2)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="userName">Nombre de Usuario (Opcional)</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" id="userName" class="form-control" 
                                   placeholder="Su nombre para personalizar">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> Acceder al Sistema
                    </button>
                </form>
                
                <div class="auth-footer">
                    <p><i class="fas fa-shield-alt"></i> Sistema protegido por autenticación de acceso</p>
                    <p class="small-text">Contacte al administrador para obtener una clave de acceso</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Aplicación principal (oculta hasta autenticación) -->
    <div id="appContainer" style="display: none;">
        <!-- Connection Status Indicator -->
        <div id="connectionStatus" class="connection-status"></div>

        <!-- Copy Notification -->
        <div id="copyNotification" class="copy-notification">
            <i class="fas fa-check-circle"></i>
            <span>Texto copiado al portapapeles</span>
        </div>

        <!-- Notification Center -->
        <div id="notificationCenter" class="notification-center">
            <div class="notification-header">
                <h3>Notificaciones</h3>
                <button id="closeNotifications" class="btn-icon"><i class="fas fa-times"></i></button>
            </div>
            <div class="notification-list" id="notificationList">
                <!-- Las notificaciones se cargarán aquí dinámicamente -->
            </div>
        </div>

        <!-- Header -->
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>PPB Cobranza</span>
                    </div>
                    <nav id="mainNav">
                        <ul>
                            <li><a href="#" class="nav-link active" data-target="dashboard">Dashboard</a></li>
                            <li><a href="#" class="nav-link" data-target="cobranzas">Cobranzas</a></li>
                            <li><a href="#" class="nav-link" data-target="proveedores">Proveedores</a></li>
                            <li><a href="#" class="nav-link" data-target="mensajes">Mensajes</a></li>
                            <li><a href="#" class="nav-link" data-target="empresa">Empresa</a></li>
                        </ul>
                    </nav>
                    <div class="user-menu">
                        <div class="user-info" id="userInfo">
                            <div class="user-avatar" id="userAvatar">U</div>
                            <span id="displayUserName">Usuario</span>
                            <span id="userPlanBadge" class="plan-badge plan-pro">Pro</span>
                        </div>
                        <button class="btn btn-icon" id="notificationBtn" title="Notificaciones">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                        </button>
                        <button class="btn btn-outline" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard -->
        <div class="container">
            <div class="dashboard" id="dashboard">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Dashboard</h1>
                    <div>
                        <button class="btn btn-primary" id="addCobranzaBtn">
                            <i class="fas fa-plus"></i> Nueva Cobranza
                        </button>
                        <button class="btn btn-outline" id="addProveedorBtn">
                            <i class="fas fa-plus"></i> Nuevo Proveedor
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <div class="stat-value" id="pendingCount">0</div>
                        <div class="stat-label">Cobranzas Pendientes</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-check-circle"></i>
                        <div class="stat-value" id="paidCount">0</div>
                        <div class="stat-label">Cobranzas Pagadas</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="stat-value" id="overdueCount">0</div>
                        <div class="stat-label">Cobranzas Vencidas</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-truck"></i>
                        <div class="stat-value" id="proveedoresCount">0</div>
                        <div class="stat-label">Proveedores Activos</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <div class="stat-value" id="totalAmount">$0</div>
                        <div class="stat-label">Total por Cobrar</div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-money-bill-wave"></i>
                        <div class="stat-value" id="totalPagos">$0</div>
                        <div class="stat-label">Total por Pagar</div>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-card">
                        <h3>Estado de Cobranzas</h3>
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Próximos Vencimientos</h3>
                        <div class="upcoming-list" id="upcomingList">
                            <!-- Los vencimientos próximos se cargarán aquí -->
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3>Actividad Reciente</h3>
                        <div class="recent-activity">
                            <ul class="activity-list" id="recentActivity">
                                <!-- Las actividades se cargarán dinámicamente -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cobranzas -->
            <div class="dashboard" id="cobranzas" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Cobranzas</h1>
                    <div>
                        <button class="btn btn-outline" id="exportExcelBtn">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                        <button class="btn btn-primary" id="addCobranzaBtn2">
                            <i class="fas fa-plus"></i> Nueva Cobranza
                        </button>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" data-tab="all">Todas</div>
                    <div class="tab" data-tab="pending">Pendientes</div>
                    <div class="tab" data-tab="paid">Pagadas</div>
                    <div class="tab" data-tab="overdue">Vencidas</div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Monto</th>
                                <th>Fecha Emisión</th>
                                <th>Fecha Vencimiento</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="cobranzasTableBody">
                            <!-- Las cobranzas se cargarán aquí dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Proveedores -->
            <div class="dashboard" id="proveedores" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Proveedores</h1>
                    <div>
                        <button class="btn btn-outline" id="exportProveedoresBtn">
                            <i class="fas fa-file-excel"></i> Exportar Excel
                        </button>
                        <button class="btn btn-primary" id="addProveedorBtn2">
                            <i class="fas fa-plus"></i> Nuevo Proveedor
                        </button>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" data-tab="all-prov">Todos</div>
                    <div class="tab" data-tab="pending-prov">Pendientes</div>
                    <div class="tab" data-tab="paid-prov">Pagados</div>
                    <div class="tab" data-tab="overdue-prov">Vencidos</div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Proveedor</th>
                                <th>Concepto</th>
                                <th>Monto</th>
                                <th>Fecha Emisión</th>
                                <th>Fecha Vencimiento</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="proveedoresTableBody">
                            <!-- Los proveedores se cargarán aquí dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Mensajes -->
            <div class="dashboard" id="mensajes" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Mensajes</h1>
                    <button class="btn btn-primary" id="addMessageBtn">
                        <i class="fas fa-plus"></i> Nuevo Mensaje
                    </button>
                </div>

                <div class="tabs">
                    <div class="tab active" data-tab="automatic">Automáticos</div>
                    <div class="tab" data-tab="custom">Personalizados</div>
                    <div class="tab" data-tab="sent">Enviados</div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th>Contenido</th>
                                <th>Destinatario</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="messagesTableBody">
                            <!-- Los mensajes se cargarán aquí dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Empresa -->
            <div class="dashboard" id="empresa" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Datos de Empresa</h1>
                </div>

                <div class="auth-card">
                    <form id="companyForm">
                        <div class="form-group">
                            <label for="companyName">Nombre de Empresa</label>
                            <input type="text" id="companyName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="companyRif">RIF / Documento Legal</label>
                            <input type="text" id="companyRif" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="companyPhone">Teléfono</label>
                            <input type="tel" id="companyPhone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="companyEmail">Email</label>
                            <input type="email" id="companyEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="companyContacts">Contactos Importantes</label>
                            <textarea id="companyContacts" class="form-control" rows="3" placeholder="Nombres y cargos de contactos clave"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar Datos</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal para Nueva Cobranza -->
        <div class="modal" id="cobranzaModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="cobranzaModalTitle">Nueva Cobranza</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <form id="cobranzaForm">
                    <input type="hidden" id="cobranzaId">
                    <div class="form-group">
                        <label for="clientName">Nombre del Cliente</label>
                        <input type="text" id="clientName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="clientPhone">Teléfono del Cliente</label>
                        <div class="phone-input-container">
                            <span class="country-code">+58</span>
                            <input type="tel" id="clientPhone" class="form-control phone-input" placeholder="412-1234567" pattern="[0-9]{3}-[0-9]{7}" required>
                        </div>
                        <small style="color: var(--gray);">Formato: 412-1234567 (sin +58)</small>
                    </div>
                    <div class="form-group">
                        <label for="clientEmail">Email del Cliente</label>
                        <input type="email" id="clientEmail" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="amount">Monto Total</label>
                        <input type="number" id="amount" class="form-control" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="issueDate">Fecha de Emisión</label>
                        <input type="date" id="issueDate" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="dueDate">Fecha de Vencimiento</label>
                        <input type="date" id="dueDate" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="notes">Notas</label>
                        <textarea id="notes" class="form-control" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="cobranzaSubmitBtn">Guardar Cobranza</button>
                </form>
            </div>
        </div>

        <!-- Modal para Nuevo Proveedor -->
        <div class="modal" id="proveedorModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="proveedorModalTitle">Nuevo Proveedor</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <form id="proveedorForm">
                    <input type="hidden" id="proveedorId">
                    <div class="form-group">
                        <label for="proveedorName">Nombre del Proveedor</label>
                        <input type="text" id="proveedorName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="proveedorContact">Persona de Contacto</label>
                        <input type="text" id="proveedorContact" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="proveedorPhone">Teléfono</label>
                        <div class="phone-input-container">
                            <span class="country-code">+58</span>
                            <input type="tel" id="proveedorPhone" class="form-control phone-input" placeholder="412-1234567" pattern="[0-9]{3}-[0-9]{7}">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="proveedorEmail">Email</label>
                        <input type="email" id="proveedorEmail" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="proveedorConcepto">Concepto del Pago</label>
                        <input type="text" id="proveedorConcepto" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="proveedorMonto">Monto a Pagar</label>
                        <input type="number" id="proveedorMonto" class="form-control" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="proveedorIssueDate">Fecha de Emisión</label>
                        <input type="date" id="proveedorIssueDate" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="proveedorDueDate">Fecha de Vencimiento</label>
                        <input type="date" id="proveedorDueDate" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="proveedorNotes">Notas</label>
                        <textarea id="proveedorNotes" class="form-control" rows="3"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="proveedorSubmitBtn">Guardar Proveedor</button>
                </form>
            </div>
        </div>

        <!-- Modal para Abonos -->
        <div class="modal" id="abonoModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Registrar Abono</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <form id="abonoForm">
                    <input type="hidden" id="abonoCobranzaId">
                    <div class="form-group">
                        <label for="abonoMonto">Monto del Abono</label>
                        <input type="number" id="abonoMonto" class="form-control" step="0.01" min="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="abonoFecha">Fecha del Abono</label>
                        <input type="date" id="abonoFecha" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="abonoNotas">Notas (opcional)</label>
                        <textarea id="abonoNotas" class="form-control" rows="2" placeholder="Ej: Pago parcial, transferencia, etc."></textarea>
                    </div>
                    <div class="form-group">
                        <p><strong>Deuda total:</strong> $<span id="deudaTotal">0</span></p>
                        <p><strong>Saldo después del abono:</strong> $<span id="saldoDespues">0</span></p>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Registrar Abono</button>
                </form>
            </div>
        </div>

        <!-- Modal para Pagos a Proveedores -->
        <div class="modal" id="pagoProveedorModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Registrar Pago a Proveedor</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <form id="pagoProveedorForm">
                    <input type="hidden" id="pagoProveedorId">
                    <div class="form-group">
                        <label for="pagoMonto">Monto del Pago</label>
                        <input type="number" id="pagoMonto" class="form-control" step="0.01" min="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="pagoFecha">Fecha del Pago</label>
                        <input type="date" id="pagoFecha" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="pagoNotas">Notas (opcional)</label>
                        <textarea id="pagoNotas" class="form-control" rows="2" placeholder="Ej: Transferencia, cheque, etc."></textarea>
                    </div>
                    <div class="form-group">
                        <p><strong>Deuda total:</strong> $<span id="deudaTotalProv">0</span></p>
                        <p><strong>Saldo después del pago:</strong> $<span id="saldoDespuesProv">0</span></p>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Registrar Pago</button>
                </form>
            </div>
        </div>

        <!-- Modal para Nuevo Mensaje -->
        <div class="modal" id="messageModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Nuevo Mensaje</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <form id="messageForm">
                    <div class="form-group">
                        <label for="messageType">Tipo de Mensaje</label>
                        <select id="messageType" class="form-control" required>
                            <option value="">Selecciona un tipo</option>
                            <option value="recordatorio_amable">Recordatorio Amable</option>
                            <option value="recordatorio_cercano">Recordatorio Cercano</option>
                            <option value="vencido_leve">Vencido Leve</option>
                            <option value="ultima_advertencia">Última Advertencia</option>
                            <option value="personalizado">Personalizado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="messageClient">Cliente Destinatario</label>
                        <select id="messageClient" class="form-control" required>
                            <option value="">Selecciona un cliente</option>
                            <!-- Los clientes se cargarán dinámicamente -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="messageContent">Contenido del Mensaje</label>
                        <textarea id="messageContent" class="form-control" rows="5" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="messageChannel">Canal de Envío</label>
                        <select id="messageChannel" class="form-control" required>
                            <option value="whatsapp">WhatsApp</option>
                            <option value="email">Email</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="sendMessageBtn">
                        <i class="fab fa-whatsapp" id="messageIcon"></i> <span id="messageText">Enviar Mensaje</span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Modal para Recibo -->
        <div class="modal" id="reciboModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Recibo de Cobranza</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="recibo-container" id="reciboContent">
                    <!-- El contenido del recibo se generará dinámicamente -->
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" id="printReciboBtn">
                        <i class="fas fa-print"></i> Imprimir Recibo
                    </button>
                    <button class="btn btn-outline" id="sendReciboBtn">
                        <i class="fas fa-paper-plane"></i> Enviar por Email
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
